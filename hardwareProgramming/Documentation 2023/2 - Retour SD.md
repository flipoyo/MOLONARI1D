# La carte SD : une fausse bonne idée ?

Cette année, on a décidé d'abandonner les *data logger* (i.e. les "enregistreurs de données") appelés "Hobbos" pour passer à un stockage SD (qui s'inscrit dans la démarche plus large d'implémentation de la télétransmission).

Pour faire simple : pour une raison plutôt obscure, l'écriture sur la carte SD est **TRES** imprévisible. Donc à des moments <u>aléatoires</u>, le contact avec la carte SD est perdu et les données ne sont pas enregistrées. OR, problème : on a construit le code tel que la télétransmission se fait à partir des données en mémoire. Donc si on perd des données, on perd aussi la télétransmission.

Donc il va falloir résoudre se probèlme assez délicat. Pas de panique on a quand même des pistes de solutions. 

* La première solution concerne la mémoire Flash qui est directement inclue dans l'Arduino. On avait typiquement commencé avec l'idée d'inscrire les données sur la mémoire Flash de l'arduino *MKR WAN 1310*. Elle a l'avantage de ne pas perdre les données inscrites dessus lorsqu'elle est hors tension. Le problème est que l'on ne peut pas aisément utiliser la mémoire Flash pour écrire des données. Il faut donc passer par une librairie qui permet de le faire. On a commencé à regarder la librairie `FlashStorage` mais elle est trop "haut niveau" donc on ne peut écrire qu'une donnée et lire une donnée à la fois (et donc la prochaine donnée écrite va écraser l'autre). Cette librairie est toutefois utilisable si on l'utilise à un niveau inférieur. Il faudra donc si vous poursuivez dans cette voie creuser le fonctionnement de la librairie `FlashStorage` et voir comment on peut l'utiliser à un niveau plus bas.

* La deuxième solution est de comprendre pourquoi cette satanée carte SD foire (carte obsolète ? problème de code ? problème de branchement ? Problème de module (on en a essayé 2 : l'adalogger featherwing, et un autre truc arduino et c'est la même chose à chaque fois)? Problème de la libraire `SD.h` ?). On est à peu près confiant sur la solidité de notre code mais ce n'est pas une piste à écarter instantanément. C'est une enquête à mener si vous vous aventurez vers cette voie. Après on a passé le trimestre a essayer cette piste sans succès.

Il faut garder à l'esprit qu'enregistrer est **la partie la plus importante du processus**. Il faut s'assurer que chaque donnée est bien enregistrée, car on ne peut pas compter sur la télétransmission pour évacuer les données de la carte.